<html lang="en">
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Kanit&display=swap" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://kit.fontawesome.com/a076d05399.js"></script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>#เซฟร้าน ณ ลาดกระบัง</title>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-storage.js"></script>
    <link rel="icon" href="cooking.png" type="image/gif" sizes="16x16">

</head>

<body onload="content_random()">
    <mobile>
        <!-- หน้าหลัก -->
        <div id="main_menu">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                </ol>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img class="d-block w-100" src="pic2.png" alt="Second slide" onclick="mockupClick('main_menu','food_menu')">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="pic3.png" alt="Second slide" onclick="mockupClick('main_menu','select_area')">
                    </div>
                </div>
                <a class="carousel-control-prev " href="#carouselExampleIndicators " role="button " data-slide="prev">
                    <span class="carousel-control-prev-icon " aria-hidden="true "></span>
                    <span class="sr-only ">Previous</span>
                </a>
                <a class="carousel-control-next " href="#carouselExampleIndicators " role="button " data-slide="next">
                    <span class="carousel-control-next-icon " aria-hidden="true "></span>
                    <span class="sr-only ">Next</span>
                </a>
            </div>

            <div id="elm1">
                <div style="margin-left: 7px;" class="pb-2">
                    <label style="margin-top:10px; margin-left:30%"><b>ลองค้นหาจากหมวดหมู่พวกนี้สิ!</b></label><br>
                    <div class="row m-3">
                        <div class="col text-center" onclick="mockupClick('main_menu','food_menu',event)" style="cursor: pointer;">
                            <img src="chicken_rice.jpg" alt="" class="icrop">
                            <label class="col pt-2" style="padding-left: 0%; padding-right: 0%; ">ข้าวมันไก่</label>
                        </div>
                        <div class="col text-center" onclick="mockupClick('main_menu','food_menu',event)" style="cursor: pointer;">
                            <img src="yumsalmon.png" alt="" class="icrop">
                            <label class="col pt-2" style="padding-left: 0%; padding-right: 0%; ">ยำ</label>
                        </div>
                        <div class="col text-center" onclick="mockupClick('main_menu','food_menu',event)" style="cursor: pointer;">
                            <img src="delivery.jpg" alt="" class="icrop">
                            <label class="col pt-2" style="padding-left: 0%; padding-right: 0%; ">เดลิเวอรี่</label>
                        </div>
                    </div>
                    <div class="row m-3">
                        <div class="col text-center" onclick="mockupClick('main_menu','food_menu',event)" style="cursor: pointer;">
                            <img src="sushi.jpg" alt="" class="icrop">
                            <label class="col pt-2" style="padding-left: 0%; padding-right: 0%; ">ซูชิ</label>
                        </div>
                        <div class="col text-center" onclick="mockupClick('main_menu','food_menu',event)" style="cursor: pointer;">
                            <img src="steak.jpg" alt="" class="icrop">
                            <label class="col pt-2" style="padding-left: 0%; padding-right: 0%; ">เสต๊ก</label>
                        </div>
                        <div class="col text-center" onclick="mockupClick('main_menu','food_menu',event)" style="cursor: pointer;">
                            <img src="boba.jpeg" alt="" class="icrop">
                            <label class="col pt-2" style="padding-left: 0%; padding-right: 0%; ">ชาไข่มุก</label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="elm2">
                <div class="m-1">
                    <div id='three_random'>

                    </div>
                </div>
                <div class="text-center">
                    <button type="button" class="btn btn-warning align-self-center" onclick="mockupClick('main_menu','select_area')">ดูร้านอาหารย่านหอเพิ่มเติม</button>
                </div>
            </div>

        </div>


        <!-- เลือกหน้าเมนู -->
        <div id="food_menu" style="display: none; ">
            <!-- Navbar -->
            <nav class="navbar navbar-dark bg-dark ">
                <a class="navbar-brand " href="# " id='heading'>ค้นหาร้านอาหารบริเวณสถาบัน</a>
            </nav>



            <!-- ช่องค้นหา -->

            <input class="form-control" type="text " placeholder="ค้นหาเมนูได้ที่นี่เล้ยยยย" aria-label="Search " id="searching" onchange="mockupClick('main_menu','food_menu')">
            <div class="text-center m-2 mb-3">
                <button class="btn btn-lg btn-block" onclick="mockupClick('food_menu', 'promote') ">โปรโมทร้านฟรี !<i class="fas fa-audio-description"></i></button>
            </div>

            <!-- Content -->
            <div id='inside_con'>
            </div>
        </div>


        <!-- Promote -->
        <div style="display: none;" id="promote" class="m-3">
            <div class="form-group">
                <label for="exampleFormControlInput1">กรอกชื่อร้าน</label>
                <input type="text" class="form-control" id="nameRes" placeholder="ex : ร้านไก่ทอดอร่อยเหาะ">
            </div>
            <div class="form-group">
                <label for="exampleFormControlTextarea1">กรอกรายละเอียดของร้าน</label>
                <textarea class="form-control" id="desc" rows="3" placeholder="ex : ทั้งตั้งของร้าน เมนูเด็ด ราคา"></textarea>
            </div>
            <div class="form-group">
                <label for="exampleFormControlFile1">อัพโหลดรูปประกอบของร้าน</label>
                <progress value="0" id="uploader" max="100">0%</progress><br><br>
                <input type="file" class="form-control-file" id="photo">
            </div>
            <div class="text-center m-2 mb-3">
                <button id="submit_link" type="submit" class="btn btn-lg btn-block" onclick="upload()">อัพโหลด</button>
            </div>
        </div>

        <!-- Section of Content -->
        <div id="main_content">

        </div>



        <!-- เลือกย่าน -->
        <div id="select_area" style="display: none; ">
            <button class="btn btn-info mt-2 " onclick="mockupClick( 'select_area', 'main_menu')" style="margin-left: 10px; ">กลับ</button>
            <div class="card rounded mx-auto d-block " style="width: 25rem; margin: 10px; ">
                <div class="card-body " onclick="mockupClick('select_area','food_menu',this)">
                    <h4 class="card-title "><b>ย่านเกกีงาม</b></h4>
                    <p class="card-text ">ย่านของกินของขายสำหรับชาวหอย่านเกกี ทีเด็ดเพียบ</p>
                </div>
            </div>

            <div class="card rounded mx-auto d-block " style="width: 25rem; margin: 10px; ">
                <div class="card-body " onclick="mockupClick('select_area','food_menu',this)">
                    <h4 class="card-title "><b>ย่านคอลเลจ</b></h4>
                    <p class="card-text ">แลนด์มาร์คสำคัญอยู่ข้างหอเอเจ เป็นตรอกแห่งร้านอาหารเด็ดๆเพียบ</p>
                </div>
            </div>

            <div class="card rounded mx-auto d-block " style="width: 25rem; margin: 10px; ">
                <div class="card-body " onclick="mockupClick('select_area','food_menu',this)">
                    <h4 class="card-title "><b>ย่านบิลเลี่ยน</b></h4>
                    <p class="card-text ">อยู่ก่อน RNP นะจ๊ะ ร้านอาหารนี่เพียบ มีร้านบอร์ดเกมด้วยซิ</p>
                </div>
            </div>

            <div class="card rounded mx-auto d-block " style="width: 25rem; margin: 10px; ">
                <div class="card-body " onclick="mockupClick('select_area','food_menu',this)">
                    <h4 class="card-title "><b>ย่านFBT</b></h4>
                    <p class="card-text ">ย่านหอ FBT นั่นเองแถวนั้นมี Tops ด้วย ร้านอาหารอร่อยๆก็มีเพียบ</p>
                </div>
            </div>

            <div class="card rounded mx-auto d-block " style="width: 25rem; margin: 10px; ">
                <div class="card-body " onclick="mockupClick('select_area','food_menu',this)">
                    <h4 class="card-title "><b>ย่านจินดา</b></h4>
                    <p class="card-text ">เลย FBT ไปออกถนนไหน บอกเลยว่าชาวดินดาร้านอาหารอร่อยๆมีเยอะไม่แพ้กัน</p>
                </div>
            </div>
        </div>
    </mobile>
</body>
<script>
    var menu_name;
    var area = new Object();
    area['ย่านเกกีงาม'] = ['เกกีงาม', 'เกกี', 'เกสี่', 'เกสาม', 'เกสอง', 'เกหนึ่ง', 'เก']
    area['ย่านคอลเลจ'] = ['คอลเลจ', 'เอเจ', 'เอเจพาร์ค']
    area['ย่านบิลเลี่ยน'] = ['บิลเลี่ยน']
    area['ย่านFBT'] = ['FBT']
    area['ย่านจินดา'] = ['จินดา', 'ถนนจินดา', 'ซอยจินดา']

    function mockupClick(pageToHide, pageToShow, event) {
        document.querySelector('#' + pageToHide).style.display = "none "
        document.querySelector('#' + pageToShow).style.display = "block "
        var T = document.querySelector('#' + pageToHide).style.display
        var S = document.querySelector('#' + pageToShow).style.display

        if (pageToShow == 'food_menu') {
            if (pageToHide == 'select_area') {
                document.getElementById('heading').innerHTML = event.children[0].innerText
            }
            if (event && pageToHide != 'select_area') {
                var tg = event.target
                if (tg.tagName == 'IMG' || tg.tagName == 'LABEL') {
                    console.log('SUCCEED')
                    tg = tg.parentNode
                }
                menu_name = tg.children[1].innerHTML
                document.getElementById('searching').value = menu_name
                console.log('CHECK')
                appending()
            } else {
                appending()

            }

        }
    }
</script>

<script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyDdobNsSUnNVWK_16IWBbOH29Aww2V7FlQ",
        authDomain: "wongnok-c0286.firebaseapp.com",
        databaseURL: "https://wongnok-c0286.firebaseio.com",
        projectId: "wongnok-c0286",
        storageBucket: "wongnok-c0286.appspot.com",
        messagingSenderId: "313780911297",
        appId: "1:313780911297:web:1238330a6375f757392840",
        measurementId: "G-VRQC2NWTTZ"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();


    var selectedFile;

    function upload() {
        var pic = document.getElementById("photo");
        selectedFile = pic.files[0];

        document.getElementById('submit_link').setAttribute('disabled', 'true');
        myfunction();
    }

    function myfunction() {
        var name = document.getElementById("photo").files.item(0).name;
        var storageRef = firebase.storage().ref('/images/' + name);
        var uploadTask = storageRef.put(selectedFile);
        uploadTask.on('state_changed', function(snapshot) {
            var progress =
                (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            var uploader = document.getElementById('uploader');
            uploader.value = progress;
            switch (snapshot.state) {
                case firebase.storage.TaskState.PAUSED:
                    console.log('Upload is paused');
                    break;
                case firebase.storage.TaskState.RUNNING:
                    console.log('Upload is running');
                    break;
            }
        }, function(error) {
            console.log(error);
        }, function() {
            uploadTask.snapshot.ref.getDownloadURL().then(
                function(downloadURL) {
                    document.getElementById('submit_link').removeAttribute('disabled');
                    var nameRes = document.getElementById('nameRes').value;
                    var desc = document.getElementById('desc').value;
                    var pic = downloadURL;

                    var counterRef = db.collection("store").doc("counter")
                    counterRef.get().then((doc) => {
                        data = doc.data()
                        id = data.count
                        console.log(data)
                        counterRef.set({
                            count: id + 1
                        }).then(() => {
                            db.collection("store").add({
                                id: id,
                                nameRes: nameRes,
                                desc: desc,
                                pic: pic,
                                access: false
                            });
                        })
                    })
                    mockupClick('promote', 'food_menu');

                });
        });
    };


    function appending() {

        var search = document.getElementById('searching').value
        var select = document.getElementById('heading').innerText
        var arr = new Array()
        console.log(search, area[select])
            // document.getElementById('main_content').innerHTML = ''
        document.getElementById('inside_con').innerHTML = ''

        db.collection('store').get().then(snapshot => {
            snapshot.forEach(doc => {

                if ((doc.data().id) == null) {
                    console.log('COUNTER SECTION')

                } else {

                    const filterItems = (arr, query) => {
                        return arr.filter(el => el.toLowerCase().indexOf(query.toLowerCase()) !== -1)
                    }
                    if (select.startsWith("ค้นหา")) {
                        if (filterItems([doc.data().nameRes], search).length > 0 || search == '' || filterItems([doc.data().desc], search).length > 0) {
                            document.getElementById('inside_con').innerHTML += "<div class='card mb-3' id='content' onclick=\"mockupClick('food_menu', 'content_ldp_" + doc.data().id + "')\">" +
                                "<img class='card-img-top crop' src='" + doc.data().pic + "'>" + "<div class='card-body '>" + " <h4 class='card-title'><b>" + doc.data().nameRes + "</b></h4>" +
                                "<p class='card-text'>" + doc.data().desc.substring(0, 45) + "...." + "</p>" + "</div>" + "</div>";

                            document.getElementById('main_content').innerHTML +=
                                "<div class='card mb-3' id='content_ldp_" + doc.data().id + "'\" style='display: none;'>" +
                                "<button class=\"btn btn-info mt-2\" onclick=\"mockupClick('content_ldp_" + doc.data().id + "', 'food_menu')\" style=\"margin-left: 0%; position: absolute;\">กลับ</button>" +
                                "<img class='cropcontent card-img-top' src='" + doc.data().pic + " alt='...'>" +
                                "<div class='card-body '>" +
                                " <h3 class='card-title'><b>" + doc.data().nameRes + "</b></h3>" +
                                "<p class='card-text'>" + doc.data().desc + "</p>" +

                                "</div>" +

                                "</div>";
                        }

                    } else {
                        for (let i = 0; i < area[select].length; i++) {
                            if ((filterItems([doc.data().nameRes], search).length > 0 || search == '' || filterItems([doc.data().desc], search).length > 0) &&
                                !arr.includes(doc.data().nameRes) && filterItems([doc.data().desc], area[select][i]).length > 0) {
                                arr.push(doc.data().nameRes)
                                console.log(arr)
                                document.getElementById('inside_con').innerHTML += "<div class='card mb-3' id='content' onclick=\"mockupClick('food_menu', 'content_ldp_" + doc.data().id + "')\">" +
                                    "<img class='card-img-top crop' src='" + doc.data().pic + "'>" + "<div class='card-body '>" + " <h4 class='card-title'><b>" + doc.data().nameRes + "</b></h4>" +
                                    "<p class='card-text'>" + doc.data().desc.substring(0, 45) + "...." + "</p>" + "</div>" + "</div>";

                                document.getElementById('main_content').innerHTML +=
                                    "<div class='card mb-3' id='content_ldp_" + doc.data().id + "'\" style='display: none;'>" +
                                    "<button class=\"btn btn-info mt-2\" onclick=\"mockupClick('content_ldp_" + doc.data().id + "', 'food_menu')\" style=\"margin-left: 0%; position: absolute;\">กลับ</button>" +
                                    "<img class='cropcontent card-img-top' src='" + doc.data().pic + " alt='...'>" +
                                    "<div class='card-body '>" +
                                    " <h3 class='card-title'><b>" + doc.data().nameRes + "</b></h3>" +
                                    "<p class='card-text'>" + doc.data().desc + "</p>" +
                                    "</div>" +
                                    "</div>";
                            }

                        }

                    }



                }
            });

        });
    }

    function displayDB(shuffled) {
        db.collection('store').get().then(snapshot => {
            snapshot.forEach(doc => {
                if (shuffled.includes(doc.data().id)) {
                    document.getElementById('three_random').innerHTML += "<div class='card mb-3  align-self-center text-center' onclick=\"mockupClick('food_menu', 'content_ldp_" + doc.data().id + "')\">" +
                        "<img class='card-img-top cropcontent_lp' src='" + doc.data().pic + "'>" + "<div class='card-body '>" +
                        " <h4 class='card-title'><b>" + doc.data().nameRes + "</b></h4>" +
                        "<p class='card-text'>" + doc.data().desc.substring(0, 45) + "...." + "</p>" + "</div>" + "</div>";
                }
            });
        });
    }

    function shuffle(array) {

        array.sort(() => Math.random() - 0.5);
        return array
    }

    function content_random() {

        var ranArr = new Array()

        db.collection('store').get().then(snapshot => {

            snapshot.forEach(doc => {
                if (doc.data().id != null) {

                    ranArr.push(doc.data().id)
                }

            });
            let shuffled = shuffle(ranArr)
            shuffled = shuffled.slice(0, 3)
            displayDB(shuffled)
        });
    }
</script>
<!-- db.left(newDate) -->
<!-- mockupClick('promote', 'food_menu'); -->

</html>
<!-- <div class="card mb-3 align-self-center text-center">
    <img class="card-img-top cropcontent_lp" src="junx.jpg" alt="Card image cap">
    <div class="card-body">
        <h5 class="card-title"><b>The junx</b></h5>
        <p class="card-text"><small class="text-muted">เมนูเด็ด : กระเพราหมูสามชั้น / กระเพรากุ้ง / น้ำปลาพริก</small></p>
    </div> -->
<!-- <div class="card mb-3" id="content_ldp" style="display: none;">
    <img class='cropcontent' src="https://scontent.fbkk13-1.fna.fbcdn.net/v/t1.0-9/83802511_2284522821840360_8760942915368255488_o.jpg?_nc_cat=108&_nc_sid=110474&_nc_eui2=AeHUNXgpr5ACtYlkBkzyvKoq5tq2CHYcsZ8vqcttMwgR3vw96d9DG1560px0NV_tx5aDMTLjtSbPqB-rywW3_cAVuCxDnw81D4e-nPVQWcZ4Dg&_nc_ohc=u8DefbnZbKgAX-Bpz4p&_nc_ht=scontent.fbkk13-1.fna&oh=0dc75c2e48c27ffc9fd4e1a2205c9c51&oe=5EA24033 "
        class="card-img-top " alt="... " id="content_pic">
    <div class="card-body ">
        <h3 class="card-title" id="content_title"><b>The Junx</b></h3>
        <p class="card-text" id="content_desc">ร้าน The Junx ถือเป็นร้านที่มีชื่อเสียงมากๆร้านนึงกับเมนูขึ้นชื่อ กระเพราถาด ซึ่งให้มาเยอะ แน่น สมราคามากๆ อีกทั้งยังรสชาติดีด้วย แต่บอกก่อนนะว่าร้านนี้รสชาติออกหวานนิดนึง ใครที่ชอบกินกระเพรารสออกหวานถือว่าตอบโจทย์ สำหรับกระเพราถาดราคาก็ไม่ได้แรงมาก
            ราคาจะแบ่งตามไซส์
            <b> Size M เริ่มต้นที่ 60 บาท</b> / <b> Size L เริ่มต้นที่ 130 บาท</b> / <b> Size XL เริ่มต้นที่ 220 บาท</b> / <b> Size XXL เริ่มต้นที่ 300 บาท (เยอะมากก)</b>
        </p>
        <p class="card-text "><small class="text-muted ">รีวิวโดย นายเจลิ้นทอง แผล่บๆ</small></p>
    </div>
</div> -->